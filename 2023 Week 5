-- SUMMER OF SQL WEEK 4 --
-- PD 2023 Wk 5 --
--Input data
--Create the bank code by splitting out off the letters from the Transaction code, call this field 'Bank'
--Change transaction date to the just be the month of the transaction
--Total up the transaction values so you have one row for each bank and month combination DONE UP TO HERE
--Rank each bank for their value of transactions each month against the other banks. 1st is the highest value of transactions, 3rd the lowest. 
--Without losing all of the other data fields, find:
--The average rank a bank has across all of the months, call this field 'Avg Rank per Bank'
--The average transaction value per rank, call this field 'Avg Transaction Value per Rank'
--Output the data


SELECT 
SPLIT_PART(transaction_code, '-', 1) AS bank,
MONTH(DATE(transaction_date, 'dd/MM/yyyy hh24:Mi:ss')) AS month_number,
SUM(value) AS total_transactions_value
FROM PD2023_WK01
GROUP BY (SPLIT_PART(transaction_code, '-', 1)),
    (MONTH(DATE(transaction_date, 'dd/MM/yyyy hh24:Mi:ss')));
